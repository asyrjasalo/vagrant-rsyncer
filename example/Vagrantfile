# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure(2) do |config|
  config.vm.box = 'ubuntu/trusty64'

  # Disable checking updates for faster testing
  config.vm.box_check_update = false
  config.vbguest.auto_update = false  if Vagrant.has_plugin?("vagrant-vbguest")

  config.vm.network 'private_network', type: 'dhcp'

  config.vm.synced_folder '.', '/vagrant', disabled: true

  config.vm.synced_folder "files", "/home/vagrant/files", type: 'rsync',
    rsync__args: [
      "--archive",
      "--delete",
      "--force",
      "--numeric-ids"
    ],
    rsync__exclude: [
      "/excluded_file.txt",
      "/excluded_directory",
      "excluded_nested_file.txt",
      "excluded_nested_directory",
      "*.not",
      ".git"
    ],
    rsync__verbose: true

  config.ssh.username = 'vagrant'
  config.ssh.forward_agent = true


  ### Vagrant syncer specific settings are introduced below

  # How often (in seconds) to read file system events
  # Default: 0.2. Minimum accepted value is 0.2.
  config.syncer.interval = 0.2

  # Whether or not to start watching after the machine is up, reloaded or resumed
  # Default: true
  config.syncer.run_on_startup = true

  # Whether or not to show the file system events
  # Default: false
  config.syncer.show_events = false

  # Optional SSH arguments passed to rsync for lower CPU load
  # Default: -o StrictHostKeyChecking=no, -o IdentitiesOnly=true, -o UserKnownHostsFile=/dev/null
  config.syncer.ssh_args = [
    '-o StrictHostKeyChecking=no',
    '-o IdentitiesOnly=true',
    '-o UserKnownHostsFile=/dev/null',
    '-c arcfour,blowfish-cbc',
    '-o Compression=no',
    '-o ControlMaster=auto',
    "-o ControlPath=#{File.join(Dir.tmpdir, "ssh.#{rand(1000)}")}",
    '-o ControlPersist=10m',
    '-x'
  ]
end
